---
import { Icon } from "astro-icon/components";
import DynamicIcon from "../DynamicIcon.astro";

interface Props {
  breadcrumbs: {
    label: string;
    href?: string;
  }[];
  offer: {
    badge: string;
    title: string;
    subtitle: string;
    price: number;
    offer?: number;
    monthlyPayment?: boolean;
    ctaText: string;
    ctaLink: string;
    icon: any;
  };
  schedule: {
    title: string;
    subtitle: string;
    phone: string;
    phoneLabel: string;
    scheduleText: string;
    scheduleLink: string;
  };
}

const { breadcrumbs, offer, schedule } = Astro.props;
const phoneLink = `tel:${schedule.phone.replace(/\D/g, "")}`;
---

<section class="bg-black pt-28 lg:pt-32 pb-10 lg:pb-14">
  <!-- Breadcrumb -->
  <div
    class="container mx-auto px-6 lg:px-16 mb-8 flex justify-center lg:justify-start"
  >
    <nav class="flex items-center gap-2 text-xs lg:text-sm text-neutral-500">
      {
        breadcrumbs.map((crumb, i) => (
          <>
            {i > 0 && <span class="text-neutral-200">&rsaquo;</span>}
            {crumb.href ? (
              <a href={crumb.href} class="text-neutral-200">
                {crumb.label}
              </a>
            ) : (
              <span class="text-neutral-200">{crumb.label}</span>
            )}
          </>
        ))
      }
    </nav>
  </div>

  <!-- Desktop: Grid Layout -->
  <div class="container mx-auto px-6 lg:px-16 hidden lg:block">
    <div class="grid grid-cols-2 gap-6">
      <!-- Left Card: Offer -->
      <div
        class="bg-neutral-900/60 border border-neutral-800 rounded-2xl p-8 lg:p-10 flex flex-col"
      >
        <!-- Badge -->
        <div class="mb-6">
          <span
            class="inline-flex items-center gap-1.5 bg-evergreen-900 text-[#44EE5B] text-sm font-bold px-4 py-2 rounded-full uppercase tracking-wide border border-[#44EE5B]"
          >
            <Icon name="circle-star" size={18} />
            {offer.badge}
          </span>
        </div>

        <!-- Title with icon -->
        <div class="flex items-start gap-3 mb-3">
          <div
            class="text-[#44EE5B] mt-1 bg-evergreen-900 rounded-md p-2 flex items-center justify-center"
          >
            <DynamicIcon icon={offer.icon} size={32} />
          </div>
          <p class="text-white text-2xl lg:text-4xl font-bold max-w-sm block">
            {offer.title}
          </p>
        </div>

        <!-- Subtitle -->
        <p class="text-neutral-400 text-sm mb-6">
          {offer.subtitle}
        </p>

        <!-- Divider -->
        <div class="border-t border-neutral-800 mb-8"></div>

        <!-- Price -->
        <div class="mb-8 flex justify-center">
          <div class="flex items-center gap-2">
            {
              offer.offer ? (
                <span class="text-neutral-400 text-md line-through">
                  ${offer.offer}
                </span>
              ) : null
            }

            <span
              class="text-[#44EE5B] text-5xl lg:text-6xl font-bold text-center"
            >
              ${offer.price}
            </span>
          </div>
          <span class="text-neutral-400 text-sm"
            >{offer.monthlyPayment ? "/per month" : ""}</span
          >
        </div>

        <!-- Divider -->
        <div class="border-t border-neutral-800 mb-4"></div>

        <!-- CTA Button -->
        <a
          href={offer.ctaLink}
          class="block w-full bg-evergreen-primary hover:bg-evergreen-600 text-white font-bold py-4 rounded-full transition-colors text-center text-lg uppercase tracking-wide"
        >
          {offer.ctaText}
        </a>
      </div>

      <!-- Right Card: Schedule -->
      <div
        class="bg-neutral-900/60 border border-neutral-800 rounded-2xl p-8 lg:p-10 flex flex-col items-center text-center justify-center"
      >
        <!-- Title -->
        <h2
          class="text-white text-2xl lg:text-4xl font-bold mb-2 leading-tight"
        >
          {schedule.title}
        </h2>

        <!-- Subtitle -->
        <p class="text-neutral-400 text-md mb-8">
          {schedule.subtitle}
        </p>

        <!-- Clock Icon -->
        <div
          class="w-24 h-24 border border-neutral-800 rounded-2xl flex items-center justify-center mb-8"
        >
          <Icon name="clock-add" size={55} class="text-white" />
        </div>

        <!-- Call Now Button -->
        <a
          href={phoneLink}
          class="block w-full max-w-md bg-evergreen-primary hover:bg-evergreen-600 text-white font-bold py-4 rounded-full transition-colors text-center text-md uppercase tracking-wide mb-3"
        >
          {schedule.phoneLabel}
          {schedule.phone}
        </a>

        <!-- Schedule Now Button -->
        <button
          type="button"
          onclick="openContactModal()"
          class="cursor-pointer flex items-center justify-center gap-2 w-full max-w-md border border-neutral-800 text-white bg-neutral-900 font-bold py-4 rounded-full transition-colors text-center text-md"
        >
          <Icon name="clock-add" size={18} />
          {schedule.scheduleText}
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile: Carousel Layout -->
  <div class="lg:hidden">
    <div class="relative flex items-center">
      <!-- Left Arrow -->
      <button
        type="button"
        class="hero-carousel-prev absolute left-2 z-10 w-10 h-10 flex items-center justify-center text-neutral-400 hover:text-white transition-colors"
        aria-label="Previous slide"
      >
        <Icon name="chevron-left" size={18} />
      </button>

      <!-- Carousel Container -->
      <div class="hero-carousel-container overflow-hidden mx-10">
        <div
          class="hero-carousel-track flex transition-transform duration-300 ease-in-out"
        >
          <!-- Slide 1: Offer Card -->
          <div class="hero-carousel-slide w-full flex-shrink-0 px-4">
            <div
              class="bg-neutral-900/60 border border-neutral-800 rounded-2xl p-6 flex flex-col"
            >
              <!-- Badge -->
              <div class="mb-2">
                <span
                  class="inline-flex items-center gap-1.5 bg-evergreen-900 text-[#44EE5B] text-xs font-bold px-4 py-2 rounded-full uppercase tracking-wide border border-[#44EE5B]"
                >
                  <Icon name="circle-star" size={16} />
                  {offer.badge}
                </span>
              </div>

              <!-- Title with icon -->
              <div class="flex items-start gap-3 mb-2">
                <div
                  class="text-[#44EE5B] bg-evergreen-900 rounded-md p-2 flex items-center justify-center flex-shrink-0"
                >
                  <Icon name="wrench-2" size={24} />
                </div>
                <p class="text-white text-xl font-bold leading-tight">
                  {offer.title}
                </p>
              </div>

              <!-- Subtitle -->
              <p class="text-neutral-400 text-sm mb-2">
                {offer.subtitle}
              </p>

              <!-- Price -->
              <div
                class="mb-2 flex flex-col w-full justify-center items-center"
              >
                <hr class="w-full border-t border-neutral-800 my-2" />

                <span class="text-[#44EE5B] text-5xl font-bold">
                  ${offer.price}
                </span>

                <hr class="w-full border-t border-neutral-800 my-2" />
              </div>

              <!-- CTA Button -->
              <a
                href={offer.ctaLink}
                class="block w-full bg-evergreen-primary hover:bg-evergreen-600 text-white font-bold py-2 rounded-full transition-colors text-center text-base uppercase tracking-wide"
              >
                {offer.ctaText}
              </a>
            </div>
          </div>

          <!-- Slide 2: Schedule Card -->
          <div class="hero-carousel-slide w-full flex-shrink-0 px-4">
            <div
              class="bg-neutral-900/60 border border-neutral-800 rounded-2xl p-6 flex flex-col items-center text-center"
            >
              <!-- Title -->
              <h2 class="text-white text-xl font-bold mb-2 leading-tight">
                {schedule.title}
              </h2>

              <!-- Subtitle -->
              <p class="text-neutral-400 text-sm mb-6">
                {schedule.subtitle}
              </p>

              <!-- Clock Icon -->
              <div
                class="w-20 h-20 border border-neutral-800 rounded-2xl flex items-center justify-center mb-6"
              >
                <Icon name="clock-add" size={44} class="text-white" />
              </div>

              <!-- Call Now Button -->
              <a
                href={phoneLink}
                class="block w-full bg-evergreen-primary hover:bg-evergreen-600 text-white font-bold py-4 rounded-full transition-colors text-center text-sm uppercase tracking-wide mb-3"
              >
                {schedule.phoneLabel}
                {schedule.phone}
              </a>

              <!-- Schedule Now Button -->
              <button
                type="button"
                onclick="openContactModal()"
                class="cursor-pointer flex items-center justify-center gap-2 w-full border border-neutral-800 text-white bg-neutral-900 font-bold py-4 rounded-full transition-colors text-center text-sm"
              >
                <Icon name="clock-add" size={16} />
                {schedule.scheduleText}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Arrow -->
      <button
        type="button"
        class="hero-carousel-next absolute right-2 z-10 w-10 h-10 flex items-center justify-center text-neutral-400 hover:text-white transition-colors"
        aria-label="Next slide"
      >
        <Icon name="chevron-right" size={18} />
      </button>
    </div>

    <!-- Dots Navigation -->
    <div class="flex justify-center gap-3 mt-6">
      <button
        type="button"
        class="hero-carousel-dot w-3 h-3 rounded-full bg-evergreen-primary transition-colors"
        data-index="0"
        aria-label="Go to slide 1"
      >
      </button>
      <button
        type="button"
        class="hero-carousel-dot w-3 h-3 rounded-full bg-neutral-600 transition-colors"
        data-index="1"
        aria-label="Go to slide 2"
      >
      </button>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const track = document.querySelector(
      ".hero-carousel-track",
    ) as HTMLElement | null;
    const slides = document.querySelectorAll(".hero-carousel-slide");
    const prevBtn = document.querySelector(".hero-carousel-prev");
    const nextBtn = document.querySelector(".hero-carousel-next");
    const dots = document.querySelectorAll(".hero-carousel-dot");

    if (!track || slides.length === 0) return;

    let currentIndex = 0;
    const totalSlides = slides.length;

    function updateCarousel() {
      if (!track) return;
      track.style.transform = `translateX(-${currentIndex * 100}%)`;

      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.remove("bg-neutral-600");
          dot.classList.add("bg-evergreen-primary");
        } else {
          dot.classList.remove("bg-evergreen-primary");
          dot.classList.add("bg-neutral-600");
        }
      });
    }

    prevBtn?.addEventListener("click", () => {
      currentIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
      updateCarousel();
    });

    nextBtn?.addEventListener("click", () => {
      currentIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
      updateCarousel();
    });

    dots.forEach((dot) => {
      dot.addEventListener("click", () => {
        const index = parseInt(dot.getAttribute("data-index") || "0", 10);
        currentIndex = index;
        updateCarousel();
      });
    });

    // Touch/Swipe support
    let touchStartX = 0;
    let touchEndX = 0;

    track.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    track.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (diff > swipeThreshold) {
        // Swipe left - next
        currentIndex = currentIndex === totalSlides - 1 ? 0 : currentIndex + 1;
        updateCarousel();
      } else if (diff < -swipeThreshold) {
        // Swipe right - prev
        currentIndex = currentIndex === 0 ? totalSlides - 1 : currentIndex - 1;
        updateCarousel();
      }
    }
  });
</script>
