---
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import { getImageUrl, processMarkdown } from "../../utils/payload";
import DynamicIcon from "../../components/DynamicIcon.astro";

const API_URL = import.meta.env.PUBLIC_API_URL;

const getSiteSettings = async () => {
  const res = await fetch(`${API_URL}/api/globals/site-settings?depth=2`);
  const data = await res.json();
  return data;
};

const getAboutUsPage = async () => {
  const res = await fetch(`${API_URL}/api/globals/about-us-page?depth=2`);
  const data = await res.json();
  return data;
};

const getContactPages = async () => {
  const res = await fetch(`${API_URL}/api/globals/contact-pages?depth=2`);
  const data = await res.json();
  return data;
};

const getServices = async () => {
  const res = await fetch(
    `${API_URL}/api/services?where[isMainService][equals]=true&limit=4&depth=2&sort=order`,
  );
  const data = await res.json();
  return data.docs || [];
};

const [siteSettings, aboutUsPage, contactPages, services] = await Promise.all([
  getSiteSettings(),
  getAboutUsPage(),
  getContactPages(),
  getServices(),
]);

const { company } = siteSettings;
const { contactForm } = contactPages;

const generateBreadcrumbs = () => {
  return [{ name: "Home", url: "/" }, { name: "About Us" }];
};
---

<Layout seoData={aboutUsPage.seo} navbarBG={true}>
  <section
    class="pt-28 lg:pt-32 pb-10 lg:pb-14 bg-white flex flex-col items-center"
  >
    <!-- Hero Section with Form -->
    <section
      class="flex justify-between items-start gap-8 container mx-auto max-w-7xl px-6 mb-12"
    >
      <!-- Left Content -->
      <section
        class="flex flex-col justify-center items-start gap-8 w-full lg:w-1/2"
      >
        <!-- Breadcrumbs -->
        <section class="flex">
          <div class="flex items-center gap-2 text-sm text-neutral-secondary">
            {
              generateBreadcrumbs().map((breadcrumb, index) => (
                <span key={breadcrumb.url} class="flex items-center gap-2">
                  <a href={breadcrumb.url} class="">
                    {breadcrumb.name}
                  </a>
                  {index < generateBreadcrumbs().length - 1 && (
                    <span class="">&rsaquo;</span>
                  )}
                </span>
              ))
            }
          </div>
        </section>

        <span
          class="bg-[#042F0A] text-[#44EE5B] border border-[#44EE5B] px-4 py-2 text-base font-bold rounded-full"
        >
          {aboutUsPage.hero.badge}
        </span>

        <div class="w-full flex flex-col gap-6">
          <h2
            class="text-3xl lg:text-4xl text-[#11BB28] font-bold leading-tight"
          >
            {aboutUsPage.hero.mainTitle}
          </h2>
          <p class="text-neutral-700 text-base leading-relaxed">
            {aboutUsPage.hero.introParagraph}
          </p>

          <h3
            class="text-3xl lg:text-4xl text-[#11BB28] font-bold leading-tight mt-4"
          >
            {aboutUsPage.hero.secondaryTitle}
          </h3>
          <p class="text-neutral-700 text-base leading-relaxed">
            {aboutUsPage.hero.secondaryParagraph}
          </p>

          <!-- Features -->
          {
            aboutUsPage.features?.map((feature: any) => (
              <div class="flex flex-col gap-3">
                <span class="bg-[#042F0A] text-[#44EE5B] border border-[#44EE5B] px-4 py-2 text-base font-bold rounded-full w-fit">
                  {feature.badge}
                </span>
                <p class="text-neutral-700 text-base leading-relaxed">
                  {feature.description}
                </p>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Right Sidebar - Form + Image -->
      <section
        class="hidden lg:flex flex-col items-center justify-start gap-6 w-1/3"
      >
        <!-- Contact Form -->
        <div
          class="rounded-3xl overflow-hidden border-2 border-neutral-300 p-6 w-full bg-white shadow-sm"
        >
          <div class="flex justify-center mb-6">
            <img
              src={getImageUrl(company.logoAlt)}
              alt={company.companyName}
              class="h-12 w-auto"
            />
          </div>

          <form id="contact-form-desktop" class="space-y-4 px-4">
            <div>
              <label class="text-black text-sm mb-2 block font-medium">
                First Name <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="firstName"
                placeholder="e.g., John"
                required
                class="w-full px-4 py-2.5 rounded-lg bg-white border border-neutral-300 text-black placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-evergreen-primary text-sm"
              />
            </div>
            <div>
              <label class="text-black text-sm mb-2 block font-medium">
                Last Name <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="lastName"
                placeholder="e.g., Smith"
                required
                class="w-full px-4 py-2.5 rounded-lg bg-white border border-neutral-300 text-black placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-evergreen-primary text-sm"
              />
            </div>
            <div>
              <label class="text-black text-sm mb-2 block font-medium">
                Email <span class="text-red-500">*</span>
              </label>
              <input
                type="email"
                name="email"
                placeholder="e.g., john.smith@email.com"
                required
                class="w-full px-4 py-2.5 rounded-lg bg-white border border-neutral-300 text-black placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-evergreen-primary text-sm"
              />
            </div>
            <div>
              <label class="text-black text-sm mb-2 block font-medium">
                Phone Number <span class="text-red-500">*</span>
              </label>
              <input
                type="tel"
                name="phoneNumber"
                placeholder="e.g., (401) 293-2048"
                required
                class="w-full px-4 py-2.5 rounded-lg bg-white border border-neutral-300 text-black placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-evergreen-primary text-sm"
              />
            </div>
            <div>
              <label class="text-black text-sm mb-2 block font-medium">
                How we can help you <span class="text-red-500">*</span>
              </label>
              <textarea
                name="message"
                placeholder="Tell us a bit about what you need, and we'll get back to you shortly."
                required
                rows="3"
                class="w-full px-4 py-2.5 rounded-lg bg-white border border-neutral-300 text-black placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-evergreen-primary text-sm resize-none"
              ></textarea>
            </div>

            <button
              type="submit"
              class="w-full bg-evergreen-primary hover:bg-evergreen-600 text-white py-3 rounded-full font-semibold text-base transition-colors"
            >
              {contactForm.submitText}
            </button>
          </form>
        </div>

        <!-- Sidebar Image -->
        {
          aboutUsPage.sidebarImage?.image && (
            <img
              src={getImageUrl(aboutUsPage.sidebarImage.image)}
              alt="Our Team"
              class="w-full rounded-2xl object-cover shadow-sm"
            />
          )
        }
      </section>
    </section>

    <!-- Quality Section (Green) -->
    <section
      class="bg-evergreen-primary w-full flex flex-col items-center justify-center py-16 px-6"
    >
      <div class="container mx-auto max-w-7xl">
        <h4 class="text-white text-3xl font-bold mb-6">
          {aboutUsPage.qualitySection.title}
        </h4>
        <div
          class="text-white text-lg leading-relaxed max-w-4xl prose prose-lg prose-invert"
          set:html={processMarkdown(aboutUsPage.qualitySection.content)}
        />
      </div>
    </section>

    <!-- Why Choose Us Section (Black) -->
    <section
      class="bg-black w-full flex flex-col items-center justify-center py-20 px-6"
    >
      <div class="max-w-7xl mx-auto flex flex-col gap-12 w-full">
        <h5 class="text-[#11BB28] text-4xl font-bold">
          {aboutUsPage.whyChooseUs.title}
        </h5>

        <!-- Values Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {
            aboutUsPage.whyChooseUs.values?.map((value: any) => (
              <div class="group  rounded-2xl p-6 border border-neutral-800 transition-all duration-300 hover:border-[#44EE5B] hover:bg-neutral-950">
                <div class="flex items-start gap-4">
                  <div class="text-neutral-600 group-hover:text-[#44EE5B] transition-colors flex-shrink-0">
                    <DynamicIcon
                      icon={value.icon}
                      class="w-8 h-8 object-contain text-neutral-700 group-hover:text-[#44EE5B] transition-colors flex-shrink-0"
                    />
                  </div>

                  <div class="flex flex-col gap-2">
                    <h3 class="text-white text-lg font-bold group-hover:text-[#44EE5B] transition-colors">
                      {value.title}
                    </h3>
                    <p class="text-neutral-400 text-lg leading-relaxed group-hover:text-neutral-300 transition-colors">
                      {value.description}
                    </p>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Services Preview -->
    <section class="w-full bg-white py-16 px-6">
      <div class="max-w-6xl mx-auto">
        <h4 class="text-[#11BB28] text-3xl font-bold mb-8">Our Services:</h4>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Plumbing Card -->
          <a
            href="/plumbing"
            class="bg-evergreen-900 rounded-xl p-6 flex flex-col gap-3 hover:bg-evergreen-800 transition-colors group"
          >
            <div
              class="text-[#44EE5B] group-hover:text-white transition-colors flex items-center gap-1"
            >
              <Icon name="wrench-2" size={32} />
              <h5 class="text-lg font-bold">Plumbing</h5>
            </div>
            <ul class="text-neutral-300 text-sm space-y-1">
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Plumbing Repair
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Water Heater Install
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Leak Detection
              </li>
            </ul>
          </a>

          <!-- Drains Card -->
          <a
            href="/drains"
            class="bg-evergreen-900 rounded-xl p-6 flex flex-col gap-3 hover:bg-evergreen-800 transition-colors group"
          >
            <div
              class="text-[#44EE5B] group-hover:text-white transition-colors flex items-center gap-1"
            >
              <Icon name="droplet" size={32} />
              <h5 class="text-lg font-bold">Drains</h5>
            </div>
            <ul class="text-neutral-300 text-sm space-y-1">
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Drain Cleaning
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Rooter Service
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Sewer Line Repair
              </li>
            </ul>
          </a>

          <!-- Heating Card -->
          <a
            href="/heating"
            class="bg-evergreen-900 rounded-xl p-6 flex flex-col gap-3 hover:bg-evergreen-800 transition-colors group"
          >
            <div
              class="text-[#44EE5B] group-hover:text-white transition-colors flex items-center gap-1"
            >
              <Icon name="flame" size={32} />
              <h5 class="text-lg font-bold">Heating</h5>
            </div>
            <ul class="text-neutral-300 text-sm space-y-1">
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                General Heating Repair
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Boiler Thermostats
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Furnace Install
              </li>
            </ul>
          </a>

          <!-- Cooling Card -->
          <a
            href="/cooling"
            class="bg-evergreen-900 rounded-xl p-6 flex flex-col gap-3 hover:bg-evergreen-800 transition-colors group"
          >
            <div
              class="text-[#44EE5B] group-hover:text-white transition-colors flex items-center gap-1"
            >
              <Icon name="snowflake" size={32} />
              <h5 class="text-lg font-bold">Cooling</h5>
            </div>
            <ul class="text-neutral-300 text-sm space-y-1">
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                A/C Repair
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Mini-split
              </li>
              <li
                class="text-neutral-400 group-hover:text-neutral-300 transition-colors"
              >
                Air Duct Repair
              </li>
            </ul>
          </a>
        </div>
      </div>
    </section>
  </section>
</Layout>
